<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ANDS CI/CD Dashboard</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif; line-height: 1.6; color: #24292e; max-width: 800px; margin: 2rem auto; padding: 0 1rem; }
        .header { border-bottom: 1px solid #e1e4e8; padding-bottom: 1rem; margin-bottom: 2rem; }
        .status-badge { display: inline-block; padding: 0.25rem 0.5rem; border-radius: 6px; font-weight: 600; font-size: 0.875rem; }
        .status-pass { background-color: #dbeddb; color: #1c521c; }
        .status-fail { background-color: #ffeef0; color: #b62324; }
        .status-warn { background-color: #fff5b1; color: #735c0f; }
        .section { margin-bottom: 2rem; }
        table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
        th, td { text-align: left; padding: 0.75rem; border-bottom: 1px solid #e1e4e8; }
        th { background-color: #f6f8fa; }
        .delta-up { color: #d73a49; }
        .delta-down { color: #28a745; }
        .footer { font-size: 0.875rem; color: #6a737d; margin-top: 4rem; border-top: 1px solid #e1e4e8; padding-top: 1rem; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ðŸ§­ ANDS Compliance Dashboard</h1>
        <p>Report generated on: {{ timestamp }}</p>
    </div>

    <div class="section">
        <h2>Summary</h2>
        <p><strong>Target:</strong> {{ target }}</p>
        <p><strong>ANDS Version:</strong> {{ version }}</p>
        <p><strong>Integrity:</strong>
            <span class="status-badge {{ 'status-pass' if validation_ok and signature_ok else 'status-fail' }}">
                {{ 'VERIFIED' if validation_ok and signature_ok else 'FAILED' }}
            </span>
        </p>
    </div>

    <div class="section">
        <h2>Risk Profile ({{ ands_code }})</h2>
        <table>
            <thead>
                <tr>
                    <th>Axis</th>
                    <th>Score</th>
                    <th>Delta</th>
                </tr>
            </thead>
            <tbody>
                {% for axis, val in axes.items() %}
                <tr>
                    <td><strong>{{ axis }}</strong></td>
                    <td>{{ val }}</td>
                    <td>
                        {% set d = delta.get(axis, 0) %}
                        {% if d > 0 %}
                            <span class="delta-up">â–² (+{{ d }})</span>
                        {% elif d < 0 %}
                            <span class="delta-down">â–¼ ({{ d }})</span>
                        {% else %}
                            -
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="section">
        <h2>Regulatory Compliance</h2>
        {% for fw_name, fw in compliance.items() %}
        <h3>{{ fw.framework }}</h3>
        <table>
            <thead>
                <tr>
                    <th>Article</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                {% for art_id, art in fw.articles.items() %}
                <tr>
                    <td>Art. {{ art_id }} - {{ art.title }}</td>
                    <td>
                        <span class="status-badge {{ 'status-pass' if art.status == 'Compliant' else 'status-warn' if art.status == 'Conditional' else 'status-fail' }}">
                            {{ art.status }}
                        </span>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% endfor %}
    </div>

    <div class="footer">
        Generated by ANDS Toolkit CI/CD v{{ toolkit_version }}
    </div>
</body>
</html>
